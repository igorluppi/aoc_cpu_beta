module send_control(clock, opcode, arduino_sig_snd, snd_flag)

parameter OPCODE_SND = <CONSTANT_PARAM>; // opcode padrao do send

input clock, arduino_sig_rcv;
output snd_flag;
wire snd_inst;
reg sig;

oneshot pulser(clock, sig, snd_flag); // trata o sinal para permitir somente um send por receive

always@(*) begin
if (snd_inst == 1'b0 && arduino_sig_snd == 1'b1)
  sig <= sig;
else if (snd_inst == 1'b1 && arduino_sig_snd == 1'b1)
  sig <= 1'b1;
else
  sig <= 1'b0;
end

assign snd_inst = (opcode == OPCODE_SND) ? 1'b1 : 1'b0; // verifica se a instrucao atual e de send.
endmodule
